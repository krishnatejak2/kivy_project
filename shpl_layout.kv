#:kivy 1.11.1

<ChangeDataPopup>:
    title: "Enter Label :"
    size_hint: None, None
    size: 400, 400
    auto_dismiss: False
    dropdown_button : dropdown_button_id
    change_data_button_kv : change_data_button_kv_id
    spinner_kv : spinner_id
    # txtinput_label : txtinput_label_id
    BoxLayout:
        id : change_data_button_kv_id
        orientation: "vertical"
        Spinner:
            id : spinner_id
            # size_hint: None, None
            size: 100, 44
            pos_hint: {'center_x': .5, 'center_y':.5}
            text: 'Select Label'
            values : root.val_list

        BoxLayout:
            id : dropdown_button_id
            orientation: "horizontal"
            # size_hint: None, 0.2
            size_hint: (1, 0.2)
            Button:
                text: "Go"
                on_release:
                    root.change_data(spinner_id.text)
                    root.dismiss()
            Button:
                text: "Cancel"
                on_release: root.dismiss()



<ChangePageNumberPopup>:
    title: "Enter Page Number :"
    size_hint: None, None
    size: 400, 400
    auto_dismiss: False
    id : change_page_layout_id
    BoxLayout:
        orientation: "vertical"
        TextInput:
            id: txtinput_pagenum_id
            # text: "1"
            readonly: False
        BoxLayout:
            orientation: "horizontal"
            # size_hint: None, 0.2
            size_hint: (1, 0.2)
            Button:
                text: "Go"
                on_release:
                    root.change_page(txtinput_pagenum_id.text)
                    root.dismiss()
            Button:
                text: "Cancel"
                on_release: root.dismiss()



<GoBackPopup>:
    title: "All progress will be lost!"
    size_hint: None, None
    size: 400, 400
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        Label:
            text: "Continue?"
        BoxLayout:
            orientation: "horizontal"
            # size_hint: None, 0.2
            size_hint: (1, 0.2)
            Button:
                text: "Yes"
                on_release:
                    root.change_screen()
                    root.dismiss()
            Button:
                text: "Cancel"
                on_release: root.dismiss()

<TextInputPopup>:
    title: "Input Label"
    size_hint: None, None
    size: 400, 400
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        TextInput:
            id: txtinput
            text: root.obj_text
        BoxLayout:
            orientation: "horizontal"
            # size_hint: None, 0.2
            size_hint: (1, 0.2)
            Button:
                text: "Save"
                on_release:
                    root.obj.update_changes(txtinput.text)
                    root.dismiss()
            Button:
                text: "Cancel"
                on_release: root.dismiss()

<SelectableButton>:
    # Draw a background to indicate selection
    canvas.before:
        Color:
            rgba: (.0, 0.9, .1, .3) if self.selected else (0, 0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size                            

<FileChoosePopup>:
    title: "Choose a .CSV File"
    size_hint: .9, .9
    auto_dismiss: False
    filechooser : filechooser
    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser
            FileChooserIconLayout

        BoxLayout:
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Load"
                on_release: root.load(filechooser.selection)
                id: ldbtn
                disabled: True if filechooser.selection==[] else False

<DownloadChoosePopup>:
    title: "Save to location"
    size_hint: .9, .9
    auto_dismiss: False

    BoxLayout:
        orientation: "vertical"
        FileChooser:
            id: filechooser_2
            FileChooserIconLayout
        
        BoxLayout:
            orientation: "horizontal"
            size_hint: (1, 0.1)
            pos_hint: {'center_x': .5, 'center_y': .5}
            spacing: 20
            # orientation: "vertical"
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Select Folder" if filechooser_2.selection==[] else "Select File"
                on_release: 
                    root.download_to(filechooser_2.path if filechooser_2.selection==[] else filechooser_2.selection, "1" if filechooser_2.selection==[] else "0")
                id: dlbtn
                # disabled: True if filechooser_2.selection==[] else False

<Manager>:
    ImportScreen:
        id: import_screen
        name: 'import'
    ModelScreen:
        id: model_screen
        name: 'model'
        data_from_import : import_screen.data # binding
    AnalyseScreen:
        id: analyse_screen
        name: 'analyse'
    ExportScreen:
        id: export_screen
        name: 'export'
        

<ImportScreen>:
    # name: "import"

    BoxLayout:
        orientation: 'vertical'
        # size_hint : None,None
        Label:
            id: pagename_id
            text : 'Import Data'
            font_size : 50
            size_hint_y : 0.3
        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3
        BoxLayout:
            orientation: 'horizontal'
            size_hint : (0.8,0.2)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            Button:
                text: 'Choose File'
                size_hint_x : 0.4
                # size_hint_x: 0.1
                # size_hint_y: 0.1
                on_press: root.open_popup()

            TextInput:
                id: get_file
                readonly: False
                size_hint_x : 0.6
                # size_hint_x: 0.4
                # size_hint_y: 0.1
        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.4
        BoxLayout:
            orientation: 'horizontal'
            size_hint : (0.5,0.2)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            Button:
                text: 'Upload'
                # size_hint_x: 0.3           
                # size_hint_y: 0.2
                on_press: 
                    root.data_check_upload()
                    
            Button:
                text: 'Submit'
                # size_hint_x: 0.3           
                # size_hint_y: 0.2
                on_press: 
                    root.data_check_popup()
                    # app.root.current = "model"
                    root.manager.transition.direction = "left"

        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3   

<ModelScreen>:
    # name: "model"
    selectmodel : select_model_id
    selectlabel : select_label_id
    model_label : model_label
    class_label : class_label
    # mainbutton_model : mainbutton_model
    BoxLayout:
        # id : apply_model_tab_id
        orientation: 'vertical'
        Label:
            id: model_screen_label_id
            text : 'Apply Model'
            font_size : 50
            size_hint_y : 0.3

        BoxLayout:
            id : select_model_id
            orientation: 'horizontal'
            pos_hint: {'center_x': .5, 'center_y': .5}     
            size_hint : (0.8,None)
            Label :
                id : model_label
                text : 'Model'
                size_hint : (0.4,0.2)           
                pos_hint: {'center_x': .5, 'center_y': .5}

        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3                 
        BoxLayout:
            id : select_label_id
            orientation: 'horizontal'
            pos_hint: {'center_x': .5, 'center_y': .5}     
            size_hint : (0.8,None)
            Label :
                id : class_label
                text : 'Label Column'
                size_hint : (0.4,0.2)           
                pos_hint: {'center_x': .5, 'center_y': .5}
        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3 

        BoxLayout:
            id : select_apply_id
            orientation: 'horizontal'
            pos_hint: {'center_x': .5, 'center_y': .5}   
            size_hint : 0.8,0.2
            Button:
                text:'Back'
                size : root.width*0.5, root.height*0.1
                on_press: 
                    app.root.current = "import"
                    root.manager.transition.direction = "right"
            Button:
                text:'Apply'
                size : root.width*0.5, root.height*0.1
                on_press: 
                    root.apply_model()

<AnalyseScreen>:
    cells : cells_id

    BoxLayout:
        orientation: "vertical"
        ScrollView:     
            # size_hint: None, None
            size: root.width, root.height*7/8 
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            # center: root.width / 2, root.height / 2
                          
            GridLayout:
                id: cells_id
                cols : 5
                do_scroll_x: True
                do_scroll_y: True
                # height : dp(26)
                spacing : 10
                size_hint: None, None                    
                height: self.minimum_height
                width: self.minimum_width

        BoxLayout:
            orientation:'horizontal'
            size_hint: (0.5, 0.05)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            Button:
                id : pagenumber_first
                text : "<<"
                on_release:
                    root.go_to_first_page(pagenumber_id.text)
            Button:
                id : pagenumber_back
                text : "<"
                on_release:
                    root.go_to_previous_page(pagenumber_id.text)
            Button:
                id : pagenumber_id
                text : "1"
                on_release : 
                    root.change_page_from_kivy()
            Button:
                id : pagenumber_forward
                text : ">"
                on_release:
                    root.go_to_next_page(pagenumber_id.text)
            Button:
                id : pagenumber_last
                text : ">>"
                on_release:
                    root.go_to_last_page(pagenumber_id.text)
            

        BoxLayout:
            orientation:'horizontal'
            size_hint: (1, 0.1)
            Button : 
                text : "Back"
                on_release:
                    root.go_back_to()

            Button : 
                text : "Train Again"
                on_release:
                    root.re_train()
                
            Button : 
                text : "Finalize"
                on_release:
                    # root.switch_to(root.tab_list[0])
                    app.root.current = "export"
                    root.manager.transition.direction = "left"
            
            
<ExportScreen>:
    # name: "export"

    BoxLayout:
        orientation: 'vertical'
        Label:
            id: pagename_id
            text : 'Export Results'
            font_size : 50
        BoxLayout:
            orientation:'horizontal'
            size_hint : (0.8,0.2)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            Button:
                text: 'Export To'
                size_hint_x: 0.4
                on_press: root.open_popup_for_download()
            TextInput:
                id: get_save_file_name
                readonly: False
                size_hint_x: 0.6
        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3      
        Button:
            text: 'Download'                          
            size_hint : (0.5,0.2)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            on_press: 
                root.data_check_popup()
                # root.download_data(get_save_file_name.text)    
        Label:
            text : ''
            # font_size : 50
            size_hint_y : 0.3      
        Button : 
            text : "Back"
            size_hint : (0.5,0.2)
            pos_hint : {"center_x":0.5,"center_y":0.5}
            on_release:
                # root.switch_to(root.tab_list[0])
                app.root.current = "analyse"
                root.manager.transition.direction = "right"       

<excelCell>:
    size_hint: None, None
    size: 400, 40

<excelHeader>:
    size_hint: None, None
    size: 400, 40